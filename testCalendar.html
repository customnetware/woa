<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js" type="text/javascript"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
</head>
<body>

    <div title="Click on the title bar to show or hide the content." class="row">
        <div class="col-md-12">
            <div class="card mb-1">
                <div class="card-header collapsed" data-toggle="collapse" data-target="#card-events" aria-expanded="false" id="eventsHeader">
                    <span class="fa fa-calendar fa-lg"></span><span>Today's Calendar'</span>
                </div>
                <div class="card-body collapse" data-parent="#outerFrame" id="card-events">
                    <table class="table table-striped table-hover table-sm k-table">
                        <thead><tr><th>Event</th><th>Time</th><th>Location</th><th>More Info</th></tr></thead>
                        <tbody id="eventTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>





    <div id="test"><span class="fa fa-refresh fa-spin fa-lg" style="margin-right:20px"></span>Please wait...</div>
    <iframe src="Calendar/28118~19555.html" id="WOACalendar" style="width:100%; height:800px; display:none"></iframe>
    <script>
        let woaEvents = document.getElementById("WOACalendar")
        let eventTable = document.getElementById("eventTable")

        woaEvents.addEventListener("load", function () {
            let woaEventsList = woaEvents.contentWindow.document
            let testInterval = setInterval(function () {
                if (woaEventsList.getElementsByClassName("event").length > 0) {
                    clearInterval(testInterval)
                    document.getElementById("test").innerHTML = ""
                    let todaysEvents = woaEventsList.getElementsByClassName("event")
                    alert(todaysEvents.length)
                    //for (let d = 0; d < todaysEvents.length; d++) {
                    //    $.get(todaysEvents[d].getElementsByTagName("a")[0].href, function () { })
                    //        .done(function (responseText) {
                    //            let woaEvent = new DOMParser().parseFromString(responseText, "text/html")
                    //            let newRow = document.createElement("tr")
                    //            let newCol1 = document.createElement("td")
                    //            let newCol2 = document.createElement("td")
                    //            let newCol3 = document.createElement("td")
                    //            let newCol4 = document.createElement("td")
                    //            let eventTime = woaEvent.getElementsByClassName("clsInput clsBodyText")[1].innerText
                    //            let newTime = eventTime.substring(eventTime.indexOf(":") - 2)

                    //            newCol1.appendChild(document.createTextNode(woaEvent.getElementsByClassName("clsHeader")[0].innerText.trim()))
                    //            newCol2.appendChild(document.createTextNode(newTime))
                    //            newCol3.appendChild(document.createTextNode(woaEvent.getElementsByClassName("clsInput clsBodyText")[0].innerText.trim()))
                    //            newCol4.appendChild(document.createTextNode(""))

                    //            newRow.appendChild(newCol1)
                    //            newRow.appendChild(newCol2)
                    //            newRow.appendChild(newCol3)
                    //            newRow.appendChild(newCol4)
                    //            eventTable.appendChild(newRow)

                    //        })
                    //}

                }
            }, 1000)
        })
    </script>
</body>
</html>