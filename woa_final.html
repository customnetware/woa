<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js" type="text/javascript"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
</head>
<body>
    <div style="width: 100%; float: left; padding:20px; margin-top:20px">
        <div id="resDisplayName" style="float: left; display: none;"></div>
        <div class="association-name"><a href="/woa_dashboard.html">My Woodbridge</a></div>
        <div class="clsHeader" style="float:left; padding-right:25px"></div>
        <a id="HeaderPublishAuthProfile" title="" class="text-nowrap" href="javascript:AV.MyProfileMenu.launch(10518615,28118,16860439,16764170);" style="float:right; padding-right:10px">My Profile</a>
    </div><div class="clsBodyText"></div>
    <style>
        .clsHeader {
            display: none !important;
        }

        #woaContainer hr {
            margin-bottom: 10px;
            margin-top: 5px;
            height: 3px;
            background-color: black;
            border: none;
        }

        #woaContainer img {
            margin-right: 10px;
            float: left;
            width: 110px;
            padding: 3px;
            height: auto;
            border: 2px solid black;
            border-radius: 2px;
            -webkit-box-shadow: 0 11px 7px 0 rgba(0,0,0,0.19),0 13px 25px 0 rgba(0,0,0,0.3);
            box-shadow: 0 11px 7px 0 rgba(0,0,0,0.19),0 13px 25px 0 rgba(0,0,0,0.3);
        }
    </style>

    <div class="container" id="woaContainer">
        <div class="row mt-2" id="headerRow">
            <div class="col-12"><strong>My Woodbridge - Saturday, April 6th, 2024</strong><hr /></div>
            <div class="col-12"><img src="" alt="Profile Image" id="profileImage" /><span id="profileGreeting" style="font-weight:700; font-style:italic"></span></div>
        </div>
        <div class="row mt-2" id="emailRow">
            <div class="col-12"><strong>Recent Association Emails</strong><hr /></div>
            <div class="col-12">
                <ul id="emailList">
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>

        </div>
        <div class="row mt-2" id="eventRow">
            <div class="col-12"><strong>Activities and Events Flyers</strong><hr /></div>
            <div class="col-12">
                <ul id="eventList">
                </ul>
            </div>

        </div>
    </div>
    <script>
        const woaCode = {
            isLocal: (window.location.hostname == "localhost") ? ".html" : "",
            getProfile: () => {
                let profileID = /\(([^)]+)\)/.exec(document.getElementById("HeaderPublishAuthProfile").href)[1].split(",")
                let imageFile = $.get("/Member/28118~" + profileID[0] + woaCode.isLocal, function () { })
                let textFile = $.get("/news/28118~792554" + woaCode.isLocal, function () { })
                $.when(imageFile, textFile).done(function (responseIMG, responseTXT) {
                    let imageFile = new DOMParser().parseFromString(responseIMG, "text/html")
                    let userContent = new DOMParser().parseFromString(responseTXT, "text/html")
                    let timeNow = new Date().getHours()
                    let greeting = timeNow >= 5 && timeNow < 12 ? "Good Morning" : timeNow >= 12 && timeNow < 18 ? "Good Afternoon" : "Good evening"
                    let userText = document.createElement("span")
                    document.getElementById("profileImage").src = imageFile.getElementsByTagName("img")[0].src
                    document.getElementById("headerRow").children[1].appendChild(userText)
                    userText.innerHTML = userContent.getElementById("contentInner").children[2].innerHTML
                    $.get("/homepage/28118/resident-home-page" + woaCode.isLocal, function () { })
                        .done(function (responseText) {
                            let portalContent = new DOMParser().parseFromString(responseText, "text/html")
                            let recentEmails = portalContent.getElementById("panel_messages_content").getElementsByTagName("a")

                            document.getElementById("profileGreeting").innerText = greeting + portalContent.getElementsByClassName("clsHeader")[0].innerHTML.trim().replace("Welcome", "")

                            for (let p = 0; p < recentEmails.length; p++) {
                                let pageStamp = document.createElement("span")
                                let pageLink = document.createElement("a")
                                pageStamp.style.float = "right"
                                pageLink.href = recentEmails[p].href
                                pageLink.innerHTML = recentEmails[p].getAttribute("data-tooltip-title").split("by")[0].split(",")[0]
                                pageStamp.innerText = recentEmails[p].getAttribute("data-tooltip-title").split("by")[0].split(",")[1]
                                document.getElementById("emailList").children[p].appendChild(pageLink)
                                document.getElementById("emailList").children[p].appendChild(pageStamp)
                            }


                        })
                })

            },
        }
        woaCode.getProfile()
    </script>
</body>
</html>